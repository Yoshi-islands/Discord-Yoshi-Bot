let popMessages;_a43â€.w("popups",[["popMessages",["popMessages"],function(v){popMessages=v}]]);//Imports


//Discord api
const Discord = require("discord.js");
const { fileURLToPath } = require("url");
const client = new Discord.Client();

//Checking if the bot has received any messages, with the message event
client.on("message", (receivedMessage) => {
  if (receivedMessage.author == client.user) {
    //preventing bot from responding to its own messages

    return;
  }

  if (receivedMessage.content.startsWith("$")) {
    handleCommand(receivedMessage); //sending the full command
  }
});

function handleCommand(receivedMessage) {
  /*Ex : 
         input : !view genres
         normal command = view genres
         main command = view
         primary arg = genres
 */

  let normalCommand = receivedMessage.content.substr(1);
  let splitCommand = normalCommand.split(" ");
  let mainCommand = splitCommand[0];
  let primaryArgument = splitCommand.slice(1); //Will not be utilized for the help command

  //Handle everything in lower case
  mainCommand = mainCommand.toLowerCase();

  console.log(`Command received: ${mainCommand}`);
  console.log(`arguments: ${primaryArgument}`);
  console.log(`normal command ${normalCommand}`);
  console.log(`message received ${receivedMessage}`);

  //help command
  if (mainCommand == "help") {
    helpCommand(receivedMessage);
  } else if (mainCommand == "view") {
  } else {
    embedError(receivedMessage);
  }
}

//Function for creating embed errors
function embedError(receivedMessage) {
  //Create embed and send the error message
  const errorEmbed = new Discord.MessageEmbed()
    .setTitle("Sorry, that's invalid!")
    .setDescription(popMessages.helpError)
    .setThumbnail(popMessages.helpErrorimg);

  receivedMessage.channel.send(errorEmbed);
}

//Function will show am embed for the help command
function helpCommand(receivedMessage) {
  const helpEmbed = new Discord.MessageEmbed()
    .setColor(popMessages.botColour)
    .setTitle(popMessages.botTitle)
    .setAuthor(popMessages.botAuthor, popMessages.botSideimg)
    .setDescription(popMessages.botDescription)
    .setImage(popMessages.botImgurl)
    .setThumbnail(popMessages.botThumbnail)
    .addFields(
      {
        name: "$help",
        value:
          "This command will display an embed of all commands availible to use",
      },
      {
        name: "$view genres",
        value:
          "This command will allow you to view the most popular genres of anme",
      },
      {
        name: "$view genre [genre] ",
        value:
          "This command will allow you to view the animes at that specific genre ( from the list availible ). ex: $view genre romance",
      },
      {
        name: "$view [anime]",
        value:
          "This command will allow you to view details on a specific anime. ex: $view naruto",
      }
    );

  //Send this embed to the received message channel
  receivedMessage.channel.send(helpEmbed);
}

client.login("NzUxNjYwNTY1MTM4NzY3ODgz.X1MUcw.9DozILCQTerV94hoRRRsVIxw9Vc");
